{
  "version": 3,
  "sources": ["../../geotiff/dist-module/compression/lzw.js"],
  "sourcesContent": ["import BaseDecoder from './basedecoder.js';\r\n\r\nconst MIN_BITS = 9;\r\nconst CLEAR_CODE = 256; // clear code\r\nconst EOI_CODE = 257; // end of information\r\nconst MAX_BYTELENGTH = 12;\r\n\r\nfunction getByte(array, position, length) {\r\n  const d = position % 8;\r\n  const a = Math.floor(position / 8);\r\n  const de = 8 - d;\r\n  const ef = (position + length) - ((a + 1) * 8);\r\n  let fg = (8 * (a + 2)) - (position + length);\r\n  const dg = ((a + 2) * 8) - position;\r\n  fg = Math.max(0, fg);\r\n  if (a >= array.length) {\r\n    console.warn('ran off the end of the buffer before finding EOI_CODE (end on input code)');\r\n    return EOI_CODE;\r\n  }\r\n  let chunk1 = array[a] & ((2 ** (8 - d)) - 1);\r\n  chunk1 <<= (length - de);\r\n  let chunks = chunk1;\r\n  if (a + 1 < array.length) {\r\n    let chunk2 = array[a + 1] >>> fg;\r\n    chunk2 <<= Math.max(0, (length - dg));\r\n    chunks += chunk2;\r\n  }\r\n  if (ef > 8 && a + 2 < array.length) {\r\n    const hi = ((a + 3) * 8) - (position + length);\r\n    const chunk3 = array[a + 2] >>> hi;\r\n    chunks += chunk3;\r\n  }\r\n  return chunks;\r\n}\r\n\r\nfunction appendReversed(dest, source) {\r\n  for (let i = source.length - 1; i >= 0; i--) {\r\n    dest.push(source[i]);\r\n  }\r\n  return dest;\r\n}\r\n\r\nfunction decompress(input) {\r\n  const dictionaryIndex = new Uint16Array(4093);\r\n  const dictionaryChar = new Uint8Array(4093);\r\n  for (let i = 0; i <= 257; i++) {\r\n    dictionaryIndex[i] = 4096;\r\n    dictionaryChar[i] = i;\r\n  }\r\n  let dictionaryLength = 258;\r\n  let byteLength = MIN_BITS;\r\n  let position = 0;\r\n\r\n  function initDictionary() {\r\n    dictionaryLength = 258;\r\n    byteLength = MIN_BITS;\r\n  }\r\n  function getNext(array) {\r\n    const byte = getByte(array, position, byteLength);\r\n    position += byteLength;\r\n    return byte;\r\n  }\r\n  function addToDictionary(i, c) {\r\n    dictionaryChar[dictionaryLength] = c;\r\n    dictionaryIndex[dictionaryLength] = i;\r\n    dictionaryLength++;\r\n    return dictionaryLength - 1;\r\n  }\r\n  function getDictionaryReversed(n) {\r\n    const rev = [];\r\n    for (let i = n; i !== 4096; i = dictionaryIndex[i]) {\r\n      rev.push(dictionaryChar[i]);\r\n    }\r\n    return rev;\r\n  }\r\n\r\n  const result = [];\r\n  initDictionary();\r\n  const array = new Uint8Array(input);\r\n  let code = getNext(array);\r\n  let oldCode;\r\n  while (code !== EOI_CODE) {\r\n    if (code === CLEAR_CODE) {\r\n      initDictionary();\r\n      code = getNext(array);\r\n      while (code === CLEAR_CODE) {\r\n        code = getNext(array);\r\n      }\r\n\r\n      if (code === EOI_CODE) {\r\n        break;\r\n      } else if (code > CLEAR_CODE) {\r\n        throw new Error(`corrupted code at scanline ${code}`);\r\n      } else {\r\n        const val = getDictionaryReversed(code);\r\n        appendReversed(result, val);\r\n        oldCode = code;\r\n      }\r\n    } else if (code < dictionaryLength) {\r\n      const val = getDictionaryReversed(code);\r\n      appendReversed(result, val);\r\n      addToDictionary(oldCode, val[val.length - 1]);\r\n      oldCode = code;\r\n    } else {\r\n      const oldVal = getDictionaryReversed(oldCode);\r\n      if (!oldVal) {\r\n        throw new Error(`Bogus entry. Not in dictionary, ${oldCode} / ${dictionaryLength}, position: ${position}`);\r\n      }\r\n      appendReversed(result, oldVal);\r\n      result.push(oldVal[oldVal.length - 1]);\r\n      addToDictionary(oldCode, oldVal[oldVal.length - 1]);\r\n      oldCode = code;\r\n    }\r\n\r\n    if (dictionaryLength + 1 >= (2 ** byteLength)) {\r\n      if (byteLength === MAX_BYTELENGTH) {\r\n        oldCode = undefined;\r\n      } else {\r\n        byteLength++;\r\n      }\r\n    }\r\n    code = getNext(array);\r\n  }\r\n  return new Uint8Array(result);\r\n}\r\n\r\nexport default class LZWDecoder extends BaseDecoder {\r\n  decodeBlock(buffer) {\r\n    return decompress(buffer, false).buffer;\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": ["array"]
}
